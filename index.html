<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Chat Application</title>
</head>
<body>
<h1>HELLO WORLD</h1>
<input type="text" autofocus>
<div></div>
<aside></aside>
<script src="/socket.io/socket.io.js"></script>
<script>
    var name = prompt('Choose A Name') || 'user';
    var socket = io.connect('/');
    socket.emit('room',1);
    socket.on('connect', function () {
        console.log('Connected');
    });
    socket.on('disconnect', function () {
        console.log('Disconnected');
    });
    document.querySelector('input').onkeypress = function (e) {
        if(e.keyCode == 13) {
            socket.emit('message',document.querySelector('input').value, 1);
//            var p = document.createElement('p');
//            p.textContent = document.querySelector('input').value;
//            document.querySelector('div').appendChild(p);
            document.querySelector('input').value = '';
        }
    };
    var typing;
    document.querySelector('input').onkeydown = function (e) {
        clearTimeout(typing);
        if (e.keyCode != 13) {socket.emit('typing',name,1);}
    };
    document.querySelector('input').onkeyup = function (e) {
        typing = setTimeout(function () {
            socket.emit('stoptyping',1);
        },1000);
    };
    socket.on('stoptyping',function() {
        document.querySelector('aside').textContent = '';
    });
    socket.on('broadcast', function (msg) {
        var p = document.createElement('p');
            p.textContent = msg;
            document.querySelector('div').appendChild(p);
    });
    socket.on('typing',function (msg) {
        document.querySelector('aside').textContent = msg;
    });
</script>
</body>
</html>